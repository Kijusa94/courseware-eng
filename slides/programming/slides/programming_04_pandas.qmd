---
title: Programación  
subtitle: "Fundamentos"
author: M.Sc. Juan Guzman
institute: Kijusa94
---

# Introducción a Pandas 

## ¿Qué es Pandas?


Es una librería optimizada para trabajar con estructuras de datos matriciales (filas y columnas) y series temporales.

::: {.incremental}
- **Versatilidad:** Trabaja con CSV, Excel, SQL, JSON.
- **Tipos de datos:** A diferencia de Numpy, Pandas maneja datos mixtos (números, texto, fechas).
- **Estructuras Principales:**
    1. **Series:** Unidimensional (Vector).
    2. **DataFrame:** Bidimensional (Tabla).
:::

## La Estructura "Series"
Contiene dos arrays: el **índice** y los **datos**.

```{python}
#| echo: true
import pandas as pd
import random

# Serie simple con índice automático (0, 1, 2...)
s = pd.Series(['Enero', 'Febrero', 'Marzo'])

# Serie con índice personalizado
s_index = pd.Series([10, 20, 30], index=['a', 'b', 'c'])

print(s_index)

```

## Operaciones en Series

Podemos aplicar funciones matemáticas y acceder como si fueran listas.

```{python}
#| echo: true
# Generamos datos aleatorios
datos = [random.randrange(1, 50) for i in range(5)]
s = pd.Series(datos)

print(f"Valor en pos 2: {s[2]}")
print(f"Suma total: {s.sum()}")
print(f"Promedio: {s.mean()}")

```

# DataFrames: Tablas de Datos 

## Creación de DataFrames

Podemos construirlos desde listas de tuplas o diccionarios.

**Opción A: Diccionarios** (Clave = Columna)

```{python}
#| echo: true
df = pd.DataFrame({
    'Mes': ['Enero','Febrero'], 
    'Casos': [177643, 33727], 
    'UCI': [996, 333] 
})
print(df)

```

## Inspección de Datos

Métodos esenciales para conocer nuestro Dataset.

* `df.head()`: Muestra las primeras filas.
* `df.info()`: Tipos de datos y valores nulos.
* `df.describe()`: Estadísticas descriptivas (media, min, max, cuartiles).
* `df.columns`: Lista de encabezados.

```{python}
#| echo: true
#| output-location: fragment
print(df.describe())

```

# Acceso y Selección de Datos 

## Tipos de Indexación

Pandas ofrece dos formas robustas de seleccionar datos:

1. **Por Posición (iloc):** Usa índices numéricos (como matrices).
2. **Por Etiqueta (loc):** Usa los nombres de filas/columnas.

::: {.callout-warning}
El acceso directo `df['Columna']` sirve para columnas, pero para precisión se recomienda `loc` o `iloc`.
:::

## Uso de `iloc` (Posición) {.smaller}

Sintaxis: `df.iloc[<filas>, <columnas>]`

```{python}
#| echo: true
df = pd.DataFrame(
    data=[('Enero',100), ('Febrero',200), ('Marzo',300)],
    columns=['Mes','Ventas'], index=['a','b','c']
)

# Selecciones
print(df.iloc[0])       # Primera fila
print(df.iloc[:, 1])    # Segunda columna (todas las filas)
print(df.iloc[0:2])     # Rango (exclusivo el final)

```

## Uso de `loc` (Etiquetas) {.smaller}

Sintaxis: `df.loc[<etiqueta_fila>, <etiqueta_columna>]`

```{python}
#| echo: true
print(df.loc['a'])              # Fila con indice 'a'
print(df.loc['a':'b'])          # Rango (INCLUSIVO el final)
print(df.loc[:, 'Mes'])         # Columna 'Mes'

# Filtros Booleanos
print(df.loc[df.Mes == 'Enero']) # Filas donde Mes es Enero

```

## Acceso Escalar (Optimizado)

Si solo necesitamos **un solo valor**, usamos métodos rápidos:

* `iat[fila, col]`: Por posición numérica.
* `at[etiqueta_fila, etiqueta_col]`: Por nombre.

```{python}
#| echo: true
valor = df.at['b', 'Ventas'] # Fila 'b', Columna 'Ventas'
print(f"Ventas de Febrero: {valor}")

# Modificar valor
df.at['b', 'Ventas'] = 500

```

# Manejo de Archivos 

## Lectura de CSV y Excel

Funciones `read_csv` y `read_excel`.

**Parámetros Importantes:**

* `sep`: Delimitador (coma, punto y coma).
* `header`: Fila donde están los títulos (None si no hay).
* `index_col`: Qué columna usar como índice del DataFrame.
* `encoding`: 'utf-8' o 'latin-1' para tildes.

```python
df = pd.read_csv('datos.csv', sep=';', encoding='utf-8')
df_xls = pd.read_excel('datos.xlsx', sheet_name='Hoja1')

```

## Escritura de Archivos

Exportar DataFrames procesados.

```{python}
#| echo: true
#| eval: false
# CSV
df.to_csv('nuevo_archivo.csv', index=False) # index=False evita guardar el indice 0,1,2...

# Excel (Requiere engine='openpyxl' o 'xlsxwriter')
writer = pd.ExcelWriter('reporte.xlsx', engine='openpyxl')
df.to_excel(writer, sheet_name='Resumen')
writer.save()

```

# Operaciones con DataFrames 

## Concatenación

Unir DataFrames "uno debajo del otro" (axis=0) o "uno al lado del otro" (axis=1).

```{python}
#| echo: true
df1 = pd.DataFrame({'A': [1, 2]})
df2 = pd.DataFrame({'A': [3, 4]})

resultado = pd.concat([df1, df2], ignore_index=True)
print(resultado)

```

## Fusión (Merge) {.smaller}

Combina tablas basándose en una columna común (clave), similar a SQL JOIN.

`pd.merge(izq, der, on="clave", how="tipo")`

| Tipo (how) | Descripción |
| --- | --- |
| `inner` | (Intersección) Solo lo que coincide en ambos. |
| `outer` | (Unión) Todo. Rellena con NaN si falta info. |
| `left` | Todo lo de la tabla izquierda y coincidencias de la derecha. |
| `right` | Viceversa del left. |

## Limpieza de Datos

Eliminar información irrelevante o corrupta.

* **Drop:** Eliminar filas o columnas.
* `df.drop('Columna', axis=1)`


* **Manejo de Nulos (NaN):**
* `df.dropna()`: Elimina filas con huecos.
* `df.fillna(0)`: Rellena los huecos con un valor (ej. 0).



# Agrupación y Análisis 

## GroupBy

Permite dividir los datos en grupos y aplicar cálculos (contar, sumar, promediar).

Sintaxis: `df.groupby(by='Columna').funcion()`

```{python}
#| echo: true
data = {'Dieta': ['A','A','B','B'], 'Peso': [80, 82, 70, 75]}
df_g = pd.DataFrame(data)

# Promedio de peso por tipo de Dieta
print(df_g.groupby('Dieta')['Peso'].mean())

```

## Agregaciones Múltiples

Podemos pedir varias estadísticas a la vez usando `agg()`.

```{python}
#| echo: true
# Media, Mínimo y Máximo por grupo
resumen = df_g.groupby('Dieta').agg(['mean', 'min', 'max'])
print(resumen)

```

# Funciones Avanzadas: Lambda 

## Funciones Anónimas (Lambda)

Son funciones rápidas, de una sola línea, ideales para aplicar a columnas enteras.

Estructura: `lambda argumentos : expresión`

```{python}
#| echo: true
doble = lambda x: x * 2
print(doble(5))

# Condicional en lambda
es_par = lambda x: True if x%2 == 0 else False
print(es_par(4))

```

## Lambda en DataFrames (Apply)

Usamos `apply()` para ejecutar la función en cada elemento de una columna.

```{python}
#| echo: true
df = pd.DataFrame({'Precio': [100, 200, 300]})

# Calcular IVA (19%) para cada precio
df['IVA'] = df['Precio'].apply(lambda x: x * 0.19)
print(df)

```

# Series Temporales 

## Manejo de Fechas

Pandas es potente para analizar patrones en el tiempo.

1. **Conversión:** `pd.to_datetime()` convierte texto a objetos de fecha reales.
2. **Índice Temporal:** Usar la fecha como índice facilita filtrar por años o meses.

```{python}
#| echo: true
df_t = pd.DataFrame({'Fecha':['2023-01-01', '2023-02-01'], 'Val':[10,20]})
df_t['Fecha'] = pd.to_datetime(df_t['Fecha'])
df_t.set_index('Fecha', inplace=True)

# Extraer propiedades
print(df_t.index.month_name())

```

## Resampling y Agrupación Temporal

Podemos agrupar datos por periodicidad (mensual, anual) fácilmente.

```{python}
#| echo: true
#| eval: false
# Sumar casos por Nombre de Mes
df.groupby(df.index.month_name()).sum()

# Filtrar un rango de fechas
df.loc['2021-01':'2021-03']

```

# Visualización Básica 

## Intro a Matplotlib

Librería estándar para gráficos en Python. Se integra nativamente con Pandas.

```{python}
#| echo: true
import matplotlib.pyplot as plt

df = pd.DataFrame({'X':[1,2,3], 'Y':[10,30,20]})

# Gráfico de línea simple
plt.plot(df.X, df.Y)
plt.title("Ejemplo Simple")
# plt.show() # Necesario en scripts, automático en notebooks

```

## Anatomía de una Gráfica

Podemos personalizar todos los elementos:

* `plt.plot()`: Líneas.
* `plt.bar()`: Barras.
* `plt.xlabel()` / `plt.ylabel()`: Etiquetas de ejes.
* `plt.legend()`: Leyenda de las series.

```

```